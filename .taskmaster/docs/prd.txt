<context>
# Overview  
The NPCA-CRM is a new, centralized software system designed to streamline and automate the entire corporate flu vaccination process. It solves the problem of inefficient, manual workflows that currently rely on disparate tools like email, spreadsheets, and multiple software platforms. The product is primarily for internal staff, corporate clients, and nurses, and it provides value by significantly improving efficiency, enhancing the user experience for all parties, and ensuring strict data privacy and security throughout the process, from initial quote to final invoice.

# Core Features  
Quote & Financial Management
This feature automates the initial sales and final billing process. It allows staff to create, edit, and send quotes using customizable templates with smart tags that auto-populate fields. Once a quote is accepted, the system automatically generates a draft invoice in Xero, which can be adjusted for additional expenses like travel or parking. This is critical for speeding up the sales cycle and ensuring accurate, timely financial reporting.

Scheduling & Event Management
This is the central nervous system for managing all vaccination events. It provides a single, centralized calendar view for administrators to track all confirmed events and nurse assignments. The system uses smart scheduling logic to assign nurses based on availability and location, helping to minimize travel costs and prevent scheduling conflicts. This is important for operational efficiency and reliable service delivery.

Employee Booking Portal
This is the client-facing component that allows employees to book their appointments. Each client gets a customizable landing page with their branding, where employees can easily book an on-site vaccination appointment or request a flu voucher for a local pharmacy. The portal automatically sends confirmation emails and manages a waiting list for fully-booked time slots. This feature is vital for a seamless client and employee experience and reduces administrative back-and-forth.

Nurse Workflow
This is a mobile-optimized interface that empowers nurses in the field. Nurses can use their mobile devices to access job details, view patient lists, and digitally record vaccination information, including vaccine type and batch number. They can also record reasons for vaccination denial and submit post-event reports. This feature is important for streamlining on-site procedures, ensuring data accuracy, and maintaining compliance.

# User Experience  
User Personas
Internal Staff (Admin/Coordinator): Manages all aspects of the process. They need a centralized, intuitive interface to move quickly from quoting to scheduling and invoicing.

Clients (HR Managers): Approve events and monitor progress. They need a self-service dashboard with real-time stats to stay informed without constant communication.

Nurses (Onsite Practitioners): Administer vaccinations and document data. They require a simple, mobile-optimized interface that works well on-site.

Client Employees: Book appointments and complete forms. They need a user-friendly, clear booking portal.

Key User Flows
HR Manager submits a booking request.

Admin creates and sends a quote.

HR Manager accepts the quote.

Admin uses the centralized calendar to assign a Nurse.

System automatically generates an Employee Booking Portal.

Employees book appointments and fill out a digital consent form.

On the day, the Nurse uses the mobile app to view their job and digitally record vaccination details.

Post-event, the Admin finalizes the invoice via the Xero integration.

UI/UX Considerations
The system will require a responsive UI optimized for both desktop (for admins) and mobile (for nurses) use.

Mockups and wireframes will be created to ensure an intuitive and cohesive user experience across all personas.

The system should feel simple and easy to navigate to encourage a high adoption rate.


# Technical Architecture  
System Components
The system will be a multi-tenant, cloud-based application built on a microservices architecture. It will be hosted on a scalable cloud provider like AWS or Azure to ensure high availability and performance, especially during peak flu season.

User Management Service: Handles all user authentication, registration, password resets, and role-based access control (Admin, Client, Nurse, Employee).

Quote & Invoice Service: Manages the lifecycle of quotes, generates PDF documents, and interfaces with the financial system for invoicing.

Booking & Scheduling Service: The core of the system, managing a centralized calendar, event creation, nurse assignment, and time slot management.

Employee Portal Frontend: A separate, publicly accessible web application for clients and employees, with a responsive design.

Nurse Mobile API: A dedicated API to support a mobile-optimized Progressive Web App (PWA) for on-site nurse workflows.

Database: A relational database (e.g., PostgreSQL) to store all core data, including user profiles, quotes, events, and vaccination records.

Technology Stack
Framework: Next.js 15

Language: TypeScript

Database: Self-hosted Supabase / PostgreSQL

ORM: Drizzle

Authentication: better-auth

Error Tracking: Sentry

Styling: Tailwind CSS v4

Components: Shadcn-ui

Schema Validations: Zod

State Management: Zustand

Search Params State: Nuqs

Tables: Tanstack Data Tables, Dice Table

Forms: React Hook Form

Linting: ESLint

Pre-commit Hooks: Husky

Formatting: Prettier

APIs and Integrations
Xero API: For automated draft invoice creation. This is a critical dependency for the financial workflow.

Google Maps API: To be used by the smart scheduling feature for travel time estimation and route optimization.

SMS/Email Service: Integration with a third-party service (e.g., SendGrid, Twilio) for sending automated booking confirmations, vouchers, and reminders.

# Development Roadmap  
MVP Requirements
The MVP will focus on a complete, end-to-end workflow to replace the most painful manual processes.

Quote Management: Full functionality to create, save, send, and track quotes.

Basic Scheduling: A functional calendar view for admins to manually assign nurses to events.

Employee Portal: An on-site booking system where employees can book appointments and complete digital consent forms.

Nurse Mobile Workflow: The essential functions for a nurse to view job details and digitally record vaccinations.

Xero Integration: The ability to automatically create a draft invoice upon quote acceptance.

Future Enhancements
Smart Scheduling: Google Maps integration for automated nurse assignment and route optimization.

Flu Voucher System: Implement the mutually exclusive option for employees to choose between a vaccination or a voucher.

Advanced Nurse Workflow: Add location tracking for safety, vaccine stock management, and consumables tracking.

Client Self-Service: Enhance the client portal with real-time analytics and detailed reporting.

Waiting List: Implement an automated system to notify employees when a time slot becomes available.

# Logical Dependency Chain
Foundation: Build the core user authentication with better-auth and the database schemas for Users, Clients, and Quotes using Drizzle.

Admin Front-end: Create the Quote Creation & Management interface using Next.js, Shadcn-ui, and React Hook Form. This is the first step of the business process.

Scheduling Core: Implement the Centralized Scheduling logic and front-end to enable event management, using Zustand for state and Tanstack Data Tables for display.

Public-Facing Portals: Develop the Employee Booking Portal and the Nurse Mobile API/PWA, which depend on the core scheduling and event data.

Critical Integrations: Integrate the Xero API to complete the financial workflow, leveraging the data from the quote and event systems. This creates a fully functional, albeit basic, end-to-end product.

</PRD>
</context>